%!TEX root = main_RNAPyro_JCB.tex
\section{Results}
\label{sec:results}

\subsection{Implementation}
The software was implemented in Python2.7 using the \textit{mpmath}~\cite{mpmath} library
for  arbitrary floating point precision. The source code is freely available at:

%{\centering \url{https://github.com/McGill-CSB/RNApyro}\\}
%\TODOJerome{Did we set up an ad hoc website?}

{\centering \url{http://csb.cs.mcgill.ca/RNApyro}\\}
The time benchmarks were performed on an AMD Opteron(tm) Processor 6278  at 2.4 GHz with cache of 512 KB.20 cores and 175 GB ram.
Since typical use-cases of \RNApyro require efficiency and scalability, we present in TableFigure~\ref{fig:time}
typical runtimes required to compute the probabilities for  every nucleotide at every positions for a vast set of parameters.
For those tests, both the multiple sequence alignment and the reference sequence were generated uniformly at random,
based on a realistic random secondary structure, generated as described in Levin~\emph{et al}~\cite{Levin:2012kx}.
\TODOVlad{Add more extensive time benchmark, as a plot}
%\TODOVlad{Is time benchmark still on Mac mini or mcbbigram?}

\begin{figure}[t]
{\centering \includegraphics[width=.5\linewidth]{figures/TimeBenchmark}\\}

\caption{Typical runtimes required by the computation of mutational profiles 
averaged on $50$ random sequences for each length ranging from $100$ and $400$ nts, while allowing for a maximal number mutations equal to $M=10$. 
For each sequence, a random multiple sequence alignment was generated, consisting of $51$ aligned sequences, each compatible with a randomly generated consensus secondary structure. 
}
\label{fig:time}
\end{figure}


\subsection{Error Correction in 5s rRNAs}
\label{sec:5S}
To illustrate the potential of our algorithm, we applied our techniques to identify and correct point-wise errors in RNA sequences
with conserved secondary structures. More precisely, we used \RNApyro to reconstruct 5s rRNA sequences with randomly distributed
mutations. This experiment has been designed to suggest further applications to error-corrections in pyrosequencing data.

We built our data set from the 5S rRNA multiple sequence alignment (MSA) available in the Rfam Database 11.0 (Rfam id: \texttt{RF00001}).
Since our software does not currently implement gaps (mainly because scoring indels is a challenging issue that cannot be fully addressed
in this work),  we clustered together the sequences with identical gap locations. From the $54$ MSAs without gap produced, we selected the
biggest MSA  which contains $130$ sequences (out of $712$ in the original Rfam MSA). Then, in order to avoid overfitting, we used \texttt{cd-hit}
\cite{Li:2006fk} to remove sequences with more than 80\% of sequence similarity. This operation resulted in a data set of $45$ sequences. 

We designed our benchmark using a leave-one-out strategy. We randomly picked a single sequence from our data set and performed $12$ random
mutations, corresponding to an error-rate of 10\%. We repeated this operation $10$ times. The value of $\beta$ was set to $15$ (larger values gave similar results). 
To estimate the impact on the distribution of the relative weights of energy and isostericity, we used 4 different values of $\alpha = {0, 0.5, 0.8, 1.0}$. 
Similarly, we also investigated the impact of an under- and over- estimate of the number of errors, by setting the presumed number of errors to 50\% (6 mutations) and 200\% (24 mutations) of their exact number (i.e. $12$).

To evaluate our method, we computed a ROC curve representing the performance of a classifier based on the mutational probabilities computed
by \RNApyro. More specifically, we fixed a threshold $\lambda \in [0,1]$, and predicted an error at position $i$ in sequence $\omega$ if and only if the
probability $P(i,x)$ of a nucleotide $x$ exceeds this threshold. To correct the errors we used the set of nucleotides having probability
greater than $\lambda$, that is  
$$C(i) = \{ x \; | \;  x \in \{ \Ab,\Cb,\Gb,\Ub \}, P(i,x) > \lambda \mbox{ and }  n \neq \omega[i] \},$$
 where $\omega[i]$ is
the nucleotide at position $i$ in the input sequence. We note that, for lower thresholds, multiple nucleotides may be available in $C(i)$ to correct
the sequence. Here, we remind that our aim is to estimate the potential of error-correction of \RNApyro, and not to develop a full-fledged error-correction pipe-line, which  
shall be the subject of further studies. Finally, we progressively varied $\lambda$ between $0$ and $1$ to calculate the ROC curve and the area
under the curve (AUC). Our results are reported in Figure~\ref{fig:ROCall}. 

\begin{figure}
\centering
	\includegraphics[width=\textwidth]{subfigs_perform.png}\\

%\begin{subfigure}[b]{0.3\textwidth}
%\includegraphics[width=1.2\textwidth]{figures/ROC_6.pdf}
%\caption{6 mutations}
%\label{fig:ROC6mut}
%\end{subfigure}
%\hfill
%\begin{subfigure}[b]{0.3\textwidth}
%\includegraphics[width=1.2\textwidth]{figures/ROC_12.pdf}
%\caption{12 mutations}
%\label{fig:ROC12mut}
%\end{subfigure}
%\hfill
%\begin{subfigure}[b]{0.3\textwidth}
%\includegraphics[width=1.2\textwidth]{figures/ROC_24.pdf}
%\caption{24 mutations}
%\label{fig:ROC24mut}
%\end{subfigure}
\caption{Performance of error-correction. Subfigures show accuracy with under-estimated error rates (6 mutations), exact estimates (12 mutations) and over estimates 
(24 mutations). We also analyze the impact of the parameter $\alpha$ distributing the weights of stacking pair energies vs isostericity scores and use values 
ranging of $\alpha=\{0,0.5,0.8,1.0\}$. The AUC is indicated in the legend of the figures. Each individual ROC curve represent the average performance over the 10 experiments.}
\label{fig:ROCall}\SpaceCheating
\end{figure}

Our data demonstrates that our algorithm shows interesting potential for error-correction applications. First, the AUC values (up to $0.86$) indicate that a
signal has been successfully extracted. This result has been achieved with errors in loop regions (i.e. without base pairing information) and thus suggests
that correction rates in structured regions (i.e. base paired regions) could be even higher. Next, the optimal values of $\alpha$ tend to be close to $0.0$. This 
finding suggests that, at this point, the information issued from the consideration of stacking energies is currently modest. However, specific examples showed improved performance
using this energy term. Further studies must be conducted to understand how to make the best use of it. Finally, our algorithm seems robust to the number of
presumed mutations. Indeed, good AUC values are achieved even with conservative estimates for the number of errors (c.f.~50\% of the errors, leading to 
Fig.~\ref{fig:ROCall}(a)), as well as with large  values (cf~200\% of the errors  in Fig.~\ref{fig:ROCall}(c)). It is worth noting that scoring schemes giving a larger weight on
the isostericity scores (i.e. for low $\alpha$ values) seem more robust to under- and over-estimating the number of errors.

\subsection{Error Correction in 16s rRNAs}
\label{sec:16S}
\TODOTous{Describe and present results????}

To complete our benchmark we also looked at the Bacterial small subunit ribosomal RNA. 
We gathered the seed multiple sequence alignment (MSA) composed of 93 sequences from the Rfam Database 11.0 (Rfam id: RF00177)~\cite{gardner2011rfam}.
Those sequences are between 1461 and 1568 nucleotides long and yield a similarity of $69\%$.

As in Sec.~\ref{sec:5S} we used a leave-one-out strategy. Since few structures contain all gaps 
at the same positions, after selecting a sequence of interest,  we used the following strategy.
 It was applied to each sequence in the alignment. Starting with the full alignment, all positions corresponding to gaps in the sequence of interest were removed, for all sequences in the alignment.  

To simulate sequencing error in the sequence of interest,
 we use the the next-generation sequencing read simulator 
ART~\cite{huang2012art}. The Illumina technology main error mode is base substitution. We used
this model since those
are the errors that \RNApyro detects. As parameters, the reads  generated
were $75\text{bps}$ long for an average fold coverage of $5$, $10$ and $15$. 
 They yield respectively an average error rate of $2.4\%$, $0.9\%$ and $0.6\%$.
 
We used a value of $\beta=15$ and evaluated $\alpha$ at $0, 0.5, 0.8, 1.0$. 
 Additionally since the alignment still contains gap, we made sure to evaluate the isostericity 
 term only
 with sequences in the MSA where both positions in the base pair are not gaps. 
 Due to the low number of errors, we set the presumed as twice the average error rate made by ART, i.e. $4.8\%$, $1.8\%$ and $1.2\%$ for fold coverages of $5$, $10$ and $15$ respectively.

To evaluate our method, we simulated with a random sequences from the MSA every time,
 $12$ times the $5-$fold, $10$ times the $10-$fold and $14$ times the $15-$fold coverage. And we 
 evaluated the ROC curve as in Sec.~\ref{sec:5S}.
 
 \begin{figure}
\centering
\begin{subfigure}{.33\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/5fold-a}
  \caption{$5-$fold coverage}
\end{subfigure}%
\begin{subfigure}{.33\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/10fold-a}
    \caption{$10-$fold coverage}
\end{subfigure}
\begin{subfigure}{.33\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/15fold-a}
    \caption{$15-$fold coverage}
\end{subfigure}
\caption{Performance of error-correction over all positions. Subfigures show accuracy when
ART fold parameter is set to 5, 10 and $15-$fold coverage. We also analyze the impact of the parameter $\alpha$ distributing the weights of stacking pair energies vs isostericity scores and use values ranging of $\alpha = \{0, 0.5, 0.8, 1.0\}$. The AUC is indicated in the legend of the figures. Each individual ROC curve represent the average performance over at least 10 experiments.}

\label{fig:16s_all}
\end{figure}

 \begin{figure}
\centering
\begin{subfigure}{.33\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/5fold-b}
  \caption{$5-$fold coverage}
\end{subfigure}%
\begin{subfigure}{.33\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/10fold-b}
    \caption{$10-$fold coverage}
\end{subfigure}
\begin{subfigure}{.33\textwidth}
  \centering
  \includegraphics[width=\linewidth]{figures/15fold-b}
    \caption{$15-$fold coverage}
\end{subfigure}
\caption{Performance of error-correction over positions inside a base pair. Subfigures show accuracy when
ART fold parameter is set to 5, 10 and $15-$fold coverage. We also analyze the impact of the parameter $\alpha$ distributing the weights of stacking pair energies vs isostericity scores and use values ranging of $\alpha = \{0, 0.5, 0.8, 1.0\}$. The AUC is indicated in the legend of the figures. Each individual ROC curve represent the average performance over at least 10 experiments.}
\label{fig:16s_bp}
\end{figure}


